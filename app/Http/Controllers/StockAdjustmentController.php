<?php
 namespace App\Http\Controllers; use App\Models\products; use App\Models\stock; use App\Models\stockAdjustment; use App\Models\units; use App\Models\warehouses; use Illuminate\Http\Request; use Illuminate\Support\Facades\DB; class StockAdjustmentController extends Controller { public function index() { $adjustments = stockAdjustment::orderBy("\151\x64", "\144\145\163\143")->get(); $products = products::all(); $warehouses = warehouses::all(); return view("\x73\164\x6f\143\x6b\56\x61\x64\x6a\x75\163\164\155\145\156\x74\x2e\151\x6e\144\145\170", compact("\141\144\x6a\165\163\x74\x6d\145\x6e\x74\x73", "\160\x72\x6f\144\x75\143\x74\163", "\x77\x61\162\x65\150\157\x75\x73\145\163")); } public function create() { } public function store(Request $request) { try { DB::beginTransaction(); $ref = getRef(); $qty = $request->qty; stockAdjustment::create(array("\160\x72\x6f\x64\x75\143\164\x49\104" => $request->productID, "\144\x61\164\145" => $request->date, "\x74\171\160\145" => $request->type, "\x71\164\171" => $request->qty, "\156\x6f\x74\145\163" => $request->notes, "\x62\141\164\x63\150" => $request->batch, "\x65\x78\x70\151\x72\x79" => $request->expiry, "\162\x65\146\111\104" => $ref)); dashboard(); if ($request->type == "\x53\x74\x6f\143\153\55\111\156") { createStock($request->productID, $qty, 0, $request->date, "\123\164\157\x63\x6b\55\x49\x6e\72\40{$request->notes}", $ref, $request->batch, $request->expiry); } else { createStock($request->productID, 0, $qty, $request->date, "\x53\164\157\x63\x6b\x2d\117\x75\x74\72\40{$request->notes}", $ref, $request->batch, $request->expiry); } DB::commit(); return back()->with("\x73\x75\143\x63\x65\x73\x73", "\x53\x74\157\143\x6b\40\101\x64\x6a\165\163\x74\155\x65\156\164\40\x43\x72\145\141\x74\x65\x64"); } catch (\Exception $e) { DB::rollBack(); return back()->with("\x65\162\162\x6f\x72", $e->getMessage()); } } public function show(stockAdjustment $stockAdjustment) { } public function edit(stockAdjustment $stockAdjustment) { } public function update(Request $request, stockAdjustment $stockAdjustment) { } public function destroy($ref) { try { DB::beginTransaction(); stockAdjustment::where("\162\x65\146\111\x44", $ref)->delete(); stock::where("\x72\145\146\x49\104", $ref)->delete(); DB::commit(); session()->forget("\x63\x6f\x6e\146\151\162\155\145\144\x5f\160\141\x73\163\167\x6f\162\x64"); return redirect()->route("\163\x74\157\143\153\101\144\152\x75\163\x74\x6d\145\156\x74\163\x2e\x69\x6e\144\145\x78")->with("\x73\x75\x63\143\x65\x73\x73", "\x53\164\x6f\143\x6b\40\x41\x64\152\x75\x73\x74\155\145\x6e\164\40\104\x65\154\x65\164\x65\144"); } catch (\Exception $e) { DB::rollBack(); session()->forget("\143\157\156\146\151\x72\x6d\x65\x64\x5f\160\x61\x73\163\x77\157\162\144"); return redirect()->route("\163\164\157\x63\153\101\144\x6a\x75\163\164\155\145\x6e\164\x73\x2e\x69\x6e\x64\145\170")->with("\145\162\x72\157\x72", $e->getMessage()); } } }
